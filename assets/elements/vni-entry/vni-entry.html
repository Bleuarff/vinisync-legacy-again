<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/vaadin-combo-box/vaadin-combo-box.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu-light.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tab.html">
<link rel="import" href="../../bower_components/paper-checkbox/paper-checkbox.html">
<link rel='import' href='../../bower_components/iron-icons/iron-icons.html'>
<link rel='import' href='../../bower_components/iron-icons/image-icons.html'>
<link rel='import' href='../../bower_components/iron-icons/editor-icons.html'>
<link rel='import' href='../../bower_components/iron-icon/iron-icon.html'>
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel='import' href="../vni-cepages/vni-cepages.html">
<link rel="import" href="../vni-color/vni-color.html">
<link rel='import' href="../../styles/shared-styles.html">
<script src='../../bower_components/cuid/dist/browser-cuid.js'></script>

<dom-module id='vni-entry'>
  <template>
    <style include='shared-styles'>
      :host {
        display: block;
        margin-bottom: 4em;
      }
      .apogee {
        display: flex;
        flex-flow: row nowrap;
        align-items: center;
      }

      .separator {
        display: inline-block;
        margin: 0 1em;
      }

      .containing {
        width: 100%;
      }

      paper-tabs {
        --paper-tabs-selection-bar-color: var(--vni-main-color);
        font-size: 1rem;
      }

      .tags {
        display: flex;
        flex-flow: row wrap;
        justify-content: space-around;
      }

      .photo-btn {
        background: transparent;
        border: none;
        display: block;
        margin: auto;
        width: 50%;
        max-width: 10em;
      }

      .photo-icon {
        width: 3em;
        height: 3em;
        color: grey;
        cursor: pointer;
      }

      .uploader {
        position: absolute;
        opacity: 0;
      }

      .entry-img {
        display: block;
        margin: auto;
        max-width: 100%;
        max-height: 12em;
      }

      .editMenu {
        position: fixed;
        left: 0;
        bottom: 0;
        right: 0;
        padding: 0.3em;
        z-index: 100;

        background-color: var(--vni-main-color);
        color: white;

        -moz-user-select: none;
        -webkit-user-select: none;
        user-select: none;
      }

      .editMenu-ctnr {
        display: flex;
        flex-flow: row nowrap;
        justify-content: space-around;
        width: 100%;
        max-width: 1000px;
        margin: auto;
      }

      .overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 90;
      }

    </style>

    <app-route route="[[route]]"
    pattern="/:id"
    data="{{routeData}}">
    </app-route>

    <div class='photo'>
      <template is='dom-if' if='[[!hasPhoto]]'>
        <input type="file" name="logo" id="logo" class="uploader" accept='image/*' capture on-change='setPhoto'/>
        <button on-tap='selectPhoto' class='photo-btn'>
          <iron-icon icon='image:camera-alt' class='photo-icon'></iron-icon>
        </button>
      </template>
      <template is='dom-if' if='[[hasPhoto]]'>
        <img class='entry-img' src='[[image]]'>
      </template>
    </div>

    <vaadin-combo-box id='appellation' label='Appellation' value='{{entry.wine.appellation}}' allow-custom-value='true'
    on-input='appellationChanged' readonly='[[!edit]]'>
    </vaadin-combo-box>

    <vaadin-combo-box id='producer' label='Producteur' value='{{entry.wine.producer}}' allow-custom-value='true'
    on-input='producerChanged' readonly='[[!edit]]'>
    </vaadin-combo-box>

    <template is='dom-if' if="[[_showProp(entry.wine.*, 'name', edit)]]">
      <paper-input id='name' label='Cuvée' value='{{entry.wine.name}}' readonly='[[!edit]]'>
      </paper-input>
    </template>

    <template is='dom-if' if="[[_showProp(entry.wine.*, 'year', edit)]]">
      <paper-input id='year' label='Millésime' value='{{entry.wine.year}}' type='number' min='1700' max='[[currentYear]]'
        readonly='[[!edit]]'>
      </paper-input>
    </template>

    <template  is='dom-if' if="[[_showProp(entry.wine.*, 'country', edit)]]">
      <vaadin-combo-box label='Pays' value='{{entry.wine.country}}' items='[[countries]]' allow-custom-value='true'
         readonly='[[!edit]]'>
      </vaadin-combo-box>
    </template>

    <div class='apogee'>
      <template is='dom-if' if="[[_showProp(entry.wine.*, 'apogeeStart', edit)]]">
        <paper-input label='Apogée' value='{{entry.wine.apogeeStart}}' type='number' min='1700' readonly='[[!edit]]'>
        </paper-input>
      </template>
      <template is='dom-if' if="[[_showApogeeSeparator(entry.wine.*, edit)]]"><span class='separator'>–</span></template>
      <template is='dom-if' if="[[_showProp(entry.wine.*, 'apogeeEnd', edit)]]">
        <paper-input label="Jusqu'à" value='{{entry.wine.apogeeEnd}}' type='number' min='[[entry.wine.apogeeStart]]'
          readonly='[[!edit]]'>
        </paper-input>
      </template>
    </div>

    <template is='dom-if' if="[[_showProp(entry.wine.*, 'color', edit)]]">
      <vni-color color='{{entry.wine.color}}' readonly='[[!edit]]'></vni-color>
    </template>

    <paper-input label='Quantité' type='number' value='{{entry.count}}' min='1' max='100' readonly='[[!edit]]'>
    </paper-input>

    <template is='dom-if' if='[[_showCepages(entry.wine.cepages, edit)]]'>
      <vni-cepages cepages='[[cepages]]' readonly='[[!edit]]'></vni-cepages>
    </template>

    <template is='dom-if' if="[[_showDetails(entry.wine.*, edit)]]">
      <span>Détails:</span>
      <div class='tags'>
        <template is='dom-if' if="[[_showProp(entry.wine.*, 'sparkling', edit)]]">
          <paper-checkbox checked='{{entry.wine.sparkling}}' class='tag' disabled='[[!edit]]'>pétillant</paper-checkbox>
        </template>
        <template is='dom-if' if="[[_showProp(entry.wine.*, 'sweet', edit)]]">
          <paper-checkbox checked='{{entry.wine.sweet}}' class='tag' disabled='[[!edit]]'>liquoreux</paper-checkbox>
        </template>
      </div>
    </template>

    <template is='dom-if' if='[[edit]]'>
      <paper-dropdown-menu-light label='Contenant' class='containing'>
        <paper-tabs class='dropdown-content' attr-for-selected='value' selected='{{entry.wine.containing}}'>
          <template is='dom-repeat' items='[[containings]]'>
            <paper-tab value='[[item]]'>[[item]]</paper-tab>
          </template>
        </paper-tabs>
      </paper-dropdown-menu-light>
    </template>
    <template is='dom-if' if='[[_showReadonlyProp(entry.wine.containing, edit)]]'>
      <paper-input label='Contenant' value='[[entry.wine.containing]]' readonly='true'></paper-input>
    </template>

    <template is='dom-if' if="[[_showProp(entry.*, 'offeredBy', edit)]]">
      <paper-input label='Offert par' value='{{entry.offeredBy}}' readonly='[[!edit]]'></paper-input>
    </template>

    <template is='dom-if' if=[[edit]]>
      <paper-button class='default big' on-tap='save'>Enregistrer</paper-button>
      <paper-button class='default big' on-tap='cancelEdit'>Annuler</paper-button>
    </template>
    <template is='dom-if' if=[[!edit]]>
      <paper-fab class='edit-fab' icon='editor:mode-edit' on-tap='openEditMenu'></paper-fab>
      <div class='editMenu hidden' tabindex='100'>
        <div class='editMenu-ctnr'>
          <paper-icon-button icon="image:exposure-plus-1" on-tap="increment"></paper-icon-button>
          <paper-icon-button icon="image:exposure-neg-1" on-tap="decrement"></paper-icon-button>
          <paper-icon-button icon="editor:mode-edit" on-tap="setEdit"></paper-icon-button>
        </div>
      </div>
      <div class='overlay hidden' on-tap='hideMenu'>
    </template>

  </template>
  <script src="vni-entry.js"></script>
</dom-module>
