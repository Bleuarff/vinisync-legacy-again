<link rel="import" href="/bower_components/vaadin-combo-box/vaadin-combo-box.html">
<link rel="import" href="/bower_components/paper-input/paper-input.html">
<link rel="import" href="/bower_components/paper-button/paper-button.html">
<link rel="import" href="/bower_components/app-route/app-route.html">
<link rel="import" href="../vni-color/vni-color.html">
<link rel="import" href="../vni-cepages/vni-cepages.html">
<link rel="import" href="../vni-tag/vni-tag.html">

<dom-module id="vni-entry">
  <template>
    <style include="shared-styles">
      :host{display: block;}

      .apogee {
        display: flex;
        flex-flow: row nowrap;
        justify-content: space-around;
        align-items: center;
      }

      .apogee paper-input {
        max-width: 45%;
      }

      .edit-false {
        --paper-input-container-underline: {
          display: none;
        }
      }

      .separator{
        padding-top: 1.1em;
      }

      .row {
        display: flex;
        flex-flow: row nowrap;
        justify-content: flex-start;
      }

      #count{
        margin-left: 50%;
      }

      #details{
        display: flex;
        flex-flow: row wrap;
        justify-content: space-around;
        margin-top: 0.25em;
      }
    </style>

    <!-- TODO:
      - style apogee block
      - moar fields
      - changer titre on load, name or producer
      - vaadin combobox really needed ?
   -->

    <app-route route="[[route]]" pattern="/:id" data="{{routeData}}"></app-route>

    <!-- <h1>Entrée</h1> -->
    <a href="/cave" class="back">
      <iron-icon icon="arrow-back"></iron-icon>Cave
    </a>

    <vaadin-combo-box label="Appellation" value="{{entry.wine.appellation}}" allow-custom-value
      on-input="appellationChanged" readonly="[[!isEdit]]" class$="edit-[[isEdit]]">
    </vaadin-combo-box>

    <vaadin-combo-box label="Producteur" value="{{entry.wine.producer}}" allow-custom-value
      on-input="producerChanged" readonly="[[!isEdit]]" class$="edit-[[isEdit]]">
    </vaadin-combo-box>

    <paper-input id="name" label="Cuvée" value="{{entry.wine.name}}"
      class$="edit-[[isEdit]] hidden-[[hideProp(entry.wine.name, isEdit)]]"
      readonly="[[!isEdit]]">
    </paper-input>

    <div class="row">
      <paper-input id="year" label="Millésime" value="{{entry.wine.year}}" type="number" min="1700"
        max="[[currentYear]]" class$="edit-[[isEdit]] hidden-[[hideProp(entry.wine.year, isEdit)]]"
        readonly="[[!isEdit]]">
      </paper-input>
      <paper-input id="count" label='Quantité' type='number' value='{{entry.count}}' min='1' max='100' readonly='[[!isEdit]]'
        class$="edit-[[isEdit]]">
      </paper-input>
    </div>

    <vaadin-combo-box label="Pays" value="{{entry.wine.country}}" items="[[countries]]" readonly="[[!isEdit]]"
      class$="edit-[[isEdit]] hidden-[[hideProp(entry.wine.country, isEdit)]]">
    </vaadin-combo-box>

    <div class="apogee">
      <paper-input label="Apogée" value="{{entry.wine.apogeeStart}}" type="number" min="1700" readonly="[[!isEdit]]"
        class$="edit-[[isEdit]] hidden-[[hideProp(entry.wine.apogeeStart, isEdit)]]">
      </paper-input>

      <span class$="separator hidden-[[hideApogeeSeparator(entry.wine.apogeeStart, entry.wine.apogeeEnd)]]">–</span>

      <paper-input label="Jusqu'à" value="{{entry.wine.apogeeEnd}}" type="number" min="[[entry.wine.apogeeStart]]"
        readonly="[[!isEdit]]" class$="edit-[[isEdit]] hidden-[[hideProp(entry.wine.apogeeEnd, isEdit)]]">
      </paper-input>
    </div>

    <vni-color color="{{entry.wine.color}}" class$="hidden-[[hideProp(entry.wine.color, isEdit)]]"
      readonly="[[!isEdit]]" >
    </vni-color>

    <vni-cepages cepages="{{entry.wine.cepages}}" class$="hidden-[[hideArrayProp(entry.wine.cepages, isEdit)]]"
      readonly="[[!isEdit]]">
    </vni-cepages>

    <label>Détails:</label>
    <div id="details">
      <vni-tag checked="{{entry.wine.sparkling}}" readonly="[[!isEdit]]" label="pétillant">
      </vni-tag>
      <vni-tag checked="{{entry.wine.sweet}}" readonly="[[!isEdit]]" label="liquoreux">
      </vni-tag>
    </div>


    <paper-button class$="hidden-[[isEdit]]" on-tap="makeEditable">Edit</paper-button>
    <paper-button class$="hidden-[[!isEdit]]" on-tap="save">Enregistrer</paper-button>

  </template>
  <script src="./vni-entry.js"></script>
</dom-module>
